!function(t){t.fn.teletype=function(e){var n=t.extend({},t.fn.teletype.defaults,e),i=t(this),o=null,a={string:"",index:0,position:0,loop:0,tag:[]},s=function(){return a.tag=[],a.index++,a.index>=n.text.length&&(a.index=0,a.loop++,0!=n.loop&&n.loop==a.loop)?!1:(a.position=0,a.string=n.text[a.index],!0)},r=function(){n.prefix&&0==a.position&&0==a.loop&&0==a.index&&t("<span />").addClass("teletype-prefix").html(n.prefix).prependTo(i);var e=a.string.split(""),g=e[a.position];if("^"==g||"~"==g){var u=a.string.substr(a.position+1).indexOf(" "),d=a.string.substr(a.position+1,u);if(t.isNumeric(d)){if(a.string=a.string.replace(g+d+" ",""),"^"==g)window.setTimeout(function(){window.setTimeout(r,p(n.typeDelay))},d);else{var h=a.position-d;a.string=a.string.substr(0,h-1)+a.string.substr(a.position-1),window.setTimeout(function(){l(Math.max(h,0))},p(n.backDelay))}return}}else if("\\"==g){var c=a.string.substr(a.position+1,1);"n"==c&&(a.position++,g="<br />")}else if(1==n.html&&"<"==g){var m=a.string.substr(a.position).match(/^(<(?:\/)?(\w+)\s?(.*?)(\/)?>).*(?=<\/\2>)?/i);if(m&&m[2])return a.string=a.string.replace(m[1],""),t(m[1]).appendTo(a.tag.length>0?t(a.tag[a.tag.length-1],o).not(".teletype-cursor").last():o),m[2].match(/^(area|br|col|embed|hr|img|input|link|meta|param)$/)||("/"==m[1].substr(1,1)&&a.tag[a.tag.length-1]==m[2]?a.tag.pop():m[4]||(a.tag[a.tag.length]=m[2])),r()}void 0!=g&&(a.tag.length>0?(t(a.tag[a.tag.length-1],o).not(".teletype-cursor").last().append(g),t(".teletype-cursor",i).detach().appendTo(t(a.tag[a.tag.length-1],o).last())):1==n.html?(o.append(g),t(".teletype-cursor",i).detach().appendTo(i)):o.text(o.text()+g),a.position++),a.position<a.string.length?window.setTimeout(r,p(n.typeDelay)):0==n.preserve?window.setTimeout(function(){window.setTimeout(l,p(n.backDelay))},n.delay):(o.html(o.html()+'<br /><span class="teletype-prefix">'+n.prefix+"</span>"),s()&&window.setTimeout(function(){window.setTimeout(r,p(n.typeDelay))},n.delay))},l=function(e){if(e||(e=0),a.position>e){if(1==n.html){var g=o.html();if(a.tag.length>0){t(".teletype-cursor",i).detach().appendTo(i);var u=t(a.tag[a.tag.length-1],o).last();if(g=u.html(),""==g)return u.remove(),a.tag.pop(),a.position++,l(e)}if(">"==g.substr(g.length-1)){var d=g.match(/([\/])?(\w+)>$/i);d&&d[1]&&(a.tag[a.tag.length]=d[2])}}a.tag.length>0?(t(a.tag[a.tag.length-1],o).not(".teletype-cursor").last().html(function(t,e){return e.slice(0,-1)}),t(".teletype-cursor",i).detach().appendTo(t(a.tag[a.tag.length-1],o).last())):1==n.html?(t(".teletype-cursor",i).detach().appendTo(i),o.html(o.html().slice(0,-1*t("<div />").html(a.string[a.position-1]).html().length))):o.text(o.text().slice(0,-1)),a.position--,window.setTimeout(function(){l(e)},p(n.backDelay))}else{if(0==e&&0==s())return;window.setTimeout(r,p(n.typeDelay))}},p=function(t){var e=parseInt(t);return n.humanise&&(e+=Math.floor(200*Math.random())),e};return this.each(function(){if(a.string=n.text[a.index],i.addClass("teletype").empty(),o=t("<span />").addClass("teletype-text").appendTo(i),n.cursor){var e=t("<span />").text(n.cursor).addClass("teletype-cursor").appendTo(i);setInterval(function(){e.animate({opacity:0}).animate({opacity:1})},n.blinkSpeed)}r()})},t.fn.teletype.defaults={text:["one","two","three"],typeDelay:100,backDelay:50,blinkSpeed:1e3,delay:2e3,cursor:"|",preserve:!1,prefix:"",loop:0,humanise:!0,html:!1}}(jQuery);
